close @all

'importamos datos del pbi
wfopen "C:\Users\diego\Dropbox\projects\Maestría\Ciclo 3\Macroeconomía II\Trabajo Final\Data BCR\serie_pbi.csv" ftype=ascii rectype=crlf skip=1 fieldtype=delimited delim=comma colhead=1 namepos=custom colheadnames=("Description") names=(periodo,pbi) eoltype=pad badfield=NA @freq Q 1980Q1 @smpl @all

'importamos datos de consumo, inversion, exportaciones e importaciones
wfopen "C:\Users\diego\Dropbox\projects\Maestría\Ciclo 3\Macroeconomía II\Trabajo Final\Data BCR\serie_c_i_x_m.csv" ftype=ascii rectype=crlf skip=1 fieldtype=delimited delim=comma colhead=1 namepos=custom colheadnames=("Description") names=(periodo,Consumo_privado,Consumo_publico,Inversion_privada,Inversion_publica,Exportaciones,Importaciones) eoltype=pad badfield=NA @freq Q 1980Q1 @smpl @all
copy SERIE_PBI::SERIE_PBI\PBI *
wfclose "c:\users\diego\dropbox\projects\maestría\ciclo 3\macroeconomía ii\trabajo final\eviews\serie_pbi.wf1"

subroutine tratamiento_datos(series original)
	%d11 = "_d11"
	%name = original.@name
'desestacionalizamos
	original.x13(save="d11", arimasmpl="1980Q1 2018Q1")  @x11()
'aplicamos log
	series ln_{%name} = log({%name}{%d11})
'aplicamos bkf
    	ln_{%name}.bpf(noncyc=tendencial_{%name}) ciclico_{%name}
endsub

'des-estacionalizamos, aplicamos logaritmo y filtramos todas las series de interes con el procedimiento tratamiento de datos

for %y pbi consumo_privado consumo_publico exportaciones importaciones
	call tratamiento_datos({%y})
next
'call tratamiento_datos(pbi)
'call tratamiento_datos(consumo_privado)
'call tratamiento_datos(consumo_publico)
'
'para replicar paper, totamos sample de 1994Q1 a 2005Q3
smpl 1994Q1 2005Q3
'
'generamos tabla resumen

table(13,2) resumen_correlaciones


resumen_correlaciones(1,1) = "retraso"
'resumen_correlaciones(1,2) = %name
for !j=-6 to 6
	resumen_correlaciones(!j+8,1) = !j
next

'definimos subroutine para generar correlaciones
subroutine local correlaciones(series serie1, series serie2, table resumen, scalar i)
	group grp1 serie1 serie2
	freeze(table1) grp1.cross(12)
	%name = serie2.@name
	resumen(1,i) = %name

	resumen(8,i) = table1(8,4)
	for !j=1 to 6
		resumen(!j+1,i) = table1(15-!j,4)
		resumen(!j+8,i) = table1(8+!j,5)
	next
endsub

'llenamos la tabla con tadas las correlaciones dinámicas
for %y pbi consumo_privado consumo_publico exportaciones importaciones
	!i = 2
	call correlaciones(ciclico_pbi, ciclico_{%y}, !i)
	!i = !i +1 
next
'call correlaciones(ciclico_pbi, ciclico_pbi, resumen_correlaciones, 2)
'call correlaciones(ciclico_pbi, ciclico_consumo_privado, resumen_correlaciones, 3)
'call correlaciones(ciclico_pbi, ciclico_consumo_publico, resumen_correlaciones, 4)
resumen_correlaciones.table
resumen_correlaciones.save(t=csv, n = "NA") tabla_correlaciones
